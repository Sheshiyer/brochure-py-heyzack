<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ company_info.name }} Product Catalog</title>
    <link rel="stylesheet" href="static/css/{{ theme }}.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Brinnan';
            src: url('data:font/opentype;base64,{{ brinnan_font_base64 }}') format('opentype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }
    </style>
    <style>
        /* PDF-specific overrides - minimal changes to preserve live catalog styling */
        body {
            background: #ffffff !important;
            color: #333 !important;
            padding: 0;
            margin: 0;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        /* Ensure proper page breaks for PDF */
        .product-page {
            page-break-after: always;
            break-after: page;
            margin: 0;
            box-shadow: none !important;
            height: 100vh;
            width: 100%;
            overflow: hidden;
            display: block !important;
            position: relative;
        }
        
        /* Remove page break from last product to avoid extra white page */
        .product-page:last-of-type {
            page-break-after: auto;
            break-after: auto;
        }
        
        /* Force each product to exactly one page */
        .product-layout.layout-structured {
            height: 100vh !important;
            max-height: 100vh !important;
            width: 100% !important;
            overflow: hidden !important;
            display: grid !important;
            grid-template-rows: 30vh 70vh !important;
            grid-template-columns: 1fr !important;
            gap: 0 !important;
        }
        
        .cover-page {
            page-break-after: always;
            break-after: page;
            margin: 0;
            height: 100vh;
            width: 100%;
        }
        
        .back-cover-fixed {
            page-break-before: always;
            break-before: page;
            margin: 0;
            height: 100vh;
            width: 100%;
            background: linear-gradient(135deg, #333232 0%, #222222 50%, #1a1a1a 100%);
            color: #ffffff;
            display: flex;
            align-items: center;
            padding: 2rem;
            overflow: hidden;
            box-sizing: border-box;
        }
        
        .back-content-fixed {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            width: 100%;
            height: 100%;
            align-items: center;
        }
        
        .company-section-fixed {
            grid-column: 1 / -1;
            margin-bottom: 1rem;
        }
        
        .value-proposition h3 {
            font-size: 1.2rem;
            color: #ffffff;
            margin-bottom: 1rem;
        }
        
        .value-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .value-item {
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(232, 47, 137, 0.2);
        }
        
        .value-item h4 {
            font-size: 0.9rem;
            color: #e82f89;
            margin-bottom: 0.3rem;
        }
        
        .value-item p {
            font-size: 0.75rem;
            color: #dddddd;
            line-height: 1.3;
        }
        
        .partner-section-fixed {
            flex: 1;
            display: flex;
            align-items: center;
        }
        
        .partner-section-fixed img {
            width: 100%;
            height: auto;
            max-height: 60vh;
            object-fit: contain;
            border-radius: 0;
        }
        
        /* Force structured layout to use full page */
        .product-layout.layout-structured {
            height: 100vh !important;
            width: 100% !important;
            overflow: hidden !important;
        }
        
        .layout-structured .hero-section {
            height: 30vh !important;
            max-height: 30vh !important;
            overflow: hidden !important;
        }
        
        .layout-structured .details-section {
            height: 70vh !important;
            max-height: 70vh !important;
            overflow: hidden !important;
            display: grid !important;
            grid-template-columns: 1fr 1fr !important;
            gap: 0.5rem !important;
        }
        
        .layout-structured .left-column {
            height: 100% !important;
            overflow: visible !important;
            display: flex !important;
            flex-direction: column !important;
            padding: 0.6rem 0.4rem 0.6rem 0.8rem !important;
        }
        
        .layout-structured .right-column {
            height: 100% !important;
            overflow: visible !important;
            padding: 0.5rem !important;
        }
        
        /* Ensure content fits within page bounds */
        .layout-structured .features {
            flex: 1 !important;
            overflow: hidden !important;
            margin-bottom: 0.2rem !important;
        }
        
        .layout-structured .specifications {
            flex: 1 !important;
            overflow: hidden !important;
            margin-bottom: 0.2rem !important;
        }
        
        .layout-structured .features-content,
        .layout-structured .spec-content {
            height: auto !important;
            overflow: visible !important;
        }
        
        .layout-structured .features-text,
        .layout-structured .specifications-text {
            font-size: 0.7rem !important;
            line-height: 1.4 !important;
            max-height: 100% !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
        }
        
        .layout-structured .features-list {
            max-height: 100% !important;
            overflow: hidden !important;
        }
        
        .layout-structured .specifications-text {
            font-size: 0.7rem !important;
            line-height: 1.4 !important;
            color: #333 !important;
            white-space: pre-wrap !important;
            max-height: 100% !important;
            overflow: hidden !important;
        }
        
        /* Ensure images render properly in PDF */
        img {
            max-width: 100%;
            height: auto;
            object-fit: contain;
            display: block;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        /* Fix for base64 images */
        img[src^="data:"] {
            max-width: 100%;
            height: auto;
            object-fit: contain;
            display: block;
        }
        
        /* Prevent ONLY the entire product page from breaking across pages */
        .product-page {
            page-break-inside: avoid !important;
            break-inside: avoid !important;
        }
        
        /* Allow internal components to flow normally within the product page */
        .product-layout,
        .hero-section,
        .details-section,
        .left-column,
        .right-column,
        .features,
        .specifications,
        .product-header,
        .features-content,
        .spec-content,
        .features-list,
        .features-text,
        .specifications-text {
            page-break-inside: auto !important;
            break-inside: auto !important;
        }
        
        /* Hide live elements for PDF */
        .live-indicator,
        .pdf-export-button,
        .notification {
            display: none !important;
        }
        
        /* Remove any extra spacing that could cause white pages */
        .product-showcase {
            margin: 0 !important;
            padding: 0 !important;
        }
        
        /* Ensure no extra margins or padding */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Force each product to take exactly one page */
        .product-page + .product-page {
            page-break-before: always;
            break-before: page;
        }
        
        /* Additional fixes for content overflow */
        .product-header {
            margin-bottom: 1rem !important;
        }
        
        .product-title {
            font-size: 1.2rem !important;
            margin-bottom: 0.2rem !important;
        }
        
        .product-type, .product-model {
            font-size: 0.9rem !important;
            margin-bottom: 0.3rem !important;
        }
        
        .spec-title {
            font-size: 0.8rem !important;
            margin-bottom: 0.3rem !important;
        }
        
        .feature-item {
            font-size: 0.75rem !important;
            margin-bottom: 0.4rem !important;
        }
        
        /* Ensure images don't cause overflow */
        .hero-image img, .secondary-image img {
            width: 100% !important;
            height: 100% !important;
            object-fit: cover !important;
        }
        
        /* Allow content to display properly - remove aggressive truncation */
        .features-text, .specifications-text {
            overflow: hidden !important;
            text-overflow: ellipsis !important;
        }
        
        .features-list {
            max-height: 100% !important;
            overflow: visible !important;
        }
        
        .features-list li {
            overflow: visible !important;
        }
    </style>
</head>
<body>
    <!-- Cover Page - Exact copy from live catalog -->
    <section class="cover-page">
        {% if intro_image_base64 %}
        <img src="data:image/png;base64,{{ intro_image_base64 }}" alt="HeyZack Smart Living" class="cover-page">
        {% else %}
        <img src="static/images/intro.png" alt="HeyZack Smart Living" class="cover-page">
        {% endif %}
    </section>

    <!-- Product Showcase - Exact copy from live catalog -->
    <main class="product-showcase" id="productShowcase">
        {% set product_counter = namespace(value=1) %}
        {% for category, category_products in grouped_products.items() %}
            {% for product in category_products %}
            <section class="product-page layout-structured" data-product="{{ product_counter.value }}">
                <div class="product-layout layout-structured">
                    <!-- Hero Image Section (30% height) -->
                    <div class="hero-section">
                        <div class="hero-image">
                            {% if product.hero_image_base64 %}
                            <img src="data:image/jpeg;base64,{{ product.hero_image_base64 }}" alt="{{ product.name }}" loading="lazy">
                            {% elif product.hero_image %}
                            <img src="{{ product.hero_image }}" alt="{{ product.name }}" loading="lazy">
                            {% else %}
                            <div class="image-placeholder">
                                <span class="placeholder-text">{{ product.name[:2]|upper }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Details Section (70% height, two columns) -->
                    <div class="details-section">
                        <!-- Left Column: Specifications and Features -->
                        <div class="left-column">
                            <div class="product-header">
                                <h2 class="product-title">{{ product.name }}</h2>
                                <p class="product-type">{{ category|upper }}</p>
                                <p class="product-model">{{ product.model }}</p>
                            </div>

                            <!-- Features Section -->
                            <div class="features">
                                <h3 class="spec-title">FEATURES</h3>
                                <div class="features-content">
                                    {% if product.features %}
                                        <ul class="features-list">
                                            {% for feature in product.features[:5] %}
                                                <li class="feature-item">{{ feature }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% else %}
                                        <p>No features available for this product.</p>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Specifications Section -->
                            <div class="specifications">
                                <h3 class="spec-title">PRODUCT SPECIFICATIONS</h3>
                                <div class="spec-content">
                                    {% if product.specifications %}
                                        <div class="specifications-text">{{ product.specifications }}</div>
                                    {% else %}
                                        <p>No specifications available for this product.</p>
                                    {% endif %}
                                </div>
                            </div>

                        </div>

                        <!-- Right Column: Secondary Image -->
                        <div class="right-column">
                            <div class="secondary-image">
                                {% if product.secondary_image_base64 %}
                                <img src="data:image/jpeg;base64,{{ product.secondary_image_base64 }}" alt="{{ product.name }} - Detail View" loading="lazy">
                                {% elif product.secondary_image %}
                                <img src="{{ product.secondary_image }}" alt="{{ product.name }} - Detail View" loading="lazy">
                                {% else %}
                                <div class="image-placeholder">
                                    <span class="placeholder-text">{{ product.name[:2]|upper }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Page Number -->
                <div class="page-number">
                    <span>{{ product_counter.value }}</span>
                </div>
            </section>
            {% set product_counter.value = product_counter.value + 1 %}
            {% endfor %}
        {% endfor %}
    </main>

    <!-- Back Cover - Exact copy from live catalog -->
    <section class="back-cover-fixed">
        <div class="back-content-fixed">
          <div class="company-section-fixed">
            <div class="value-proposition">
              <h3><br>Why Choose HeyZack?</h3>
              <div class="value-grid">
                <div class="value-item">
                  <h4>AI Guardian Technology</h4>
                  <p>Proactive home management</p>
                </div>
                <div class="value-item">
                  <h4>Complete Integration</h4>
                  <p>All devices work seamlessly together</p>
                </div>
                <div class="value-item">
                  <h4>Professional Support</h4>
                  <p>Dedicated partner success program</p>
                </div>
                <div class="value-item">
                  <h4>30% Partner Margins</h4>
                  <p>Industry-leading profitability</p>
                </div>
              </div>
            </div>
          </div>
          <div class="partner-section-fixed">
            {% if outer_image_base64 %}
            <img src="data:image/png;base64,{{ outer_image_base64 }}" alt="HeyZack Partner Network">
            {% else %}
            <img src="static/images/outer.png" alt="HeyZack Partner Network">
            {% endif %}
          </div>
        </div>
      </section>
</body>
</html>
